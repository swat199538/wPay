var pay={config:{ajaxMethod:"GET",loopTime:2000,haveWechat:true,wechatOrderPath:"",wechatResultPath:"",isLoadFont:false,haveAlipay:false,orderError:"下单出现错误，请重试"},isLoad:false,ajaxIng:false,money:"",orderData:{},resultData:{},intervalId:"",endEvent:function(){},orderReturn:function(a){},payResult:function(a){},loadCss:function(){if(pay.config.isLoadFont){$("head").append('<link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">')}$("head").append('<link type="text/css" rel="stylesheet" href="'+pay.getCssUrl()+'"/>');pay.isLoad=true},show:function(a,b){if(!pay.isLoad){pay.loadCss()}pay.money=a;if(!pay.checkMoney()){layer.msg("只接受正整数的钞票,其它我们都不要！");return}b["money"]=pay.money;pay.orderData=b;pay.open(pay.confirmView())},checkMoney:function(){return true},open:function(a){$("body").append(a);pay.registerAction()},registerAction:function(){$(".close-btn").one("click",pay.close);$(".confirm-charge-btn").one("click",pay.confirm);$(".pay-method-list li").on("click",function(){$(".pay-method-list li").removeClass("chosen");$(".pay-method-list li").addClass("un-chosen");$(this).removeClass("un-chosen");$(this).addClass("chosen")})},close:function(){$("#pay-view").remove();$(".pay-method-list li").off();clearInterval(pay.intervalId)},confirm:function(){var a=pay.ensurePayTool();pay.close();switch(a){case"wechat":pay.ajax(pay.config.wechatOrderPath,pay.orderData,function(b){if(b==false){layer.msg(pay.config.orderError);return}pay.open(pay.qrCodeView(b["uri"]));pay.resultData["order"]=b["order"];pay.setLoop(pay.config.wechatResultPath,pay.resultData,function(c){if(c){pay.close();pay.open(pay.successView());setTimeout(function(){pay.close();pay.endEvent()},2000)}})},1);return;case"alipay":layer.msg("开发中");return;default:layer.msg("请选择支付方式");return}},ensurePayTool:function(){return $(".chosen").data("pay-tool")},ajax:function(a,d,c,b){if(pay.ajaxIng){return}pay.ajaxIng=true;$.ajax({type:pay.config.ajaxMethod,url:a,data:d,success:function(f){pay.ajaxIng=false;if(b==1){c(pay.orderReturn(f))}if(b==2){c(pay.payResult(f))}},dataType:"json"})},setLoop:function(a,c,b){pay.intervalId=setInterval(function(){pay.ajax(a,c,b,2)},pay.config.loopTime)},confirmView:function(){var b="";if(pay.config.haveWechat){b='<li class="chosen" data-pay-tool="wechat" >'+'<i class="icon-ok hide"></i>'+'<img class="unchosen-icon" src="https://static.baydn.com/static/img/icon-wechat-pay-unchosen.png" alt="wechat pay">'+'<img class="chosen-icon" src="https://static.baydn.com/static/img/wechat-pay.png" alt="wechat pay">'+"<span>微信支付</span>"+"</li>"}var a="";if(pay.config.haveAlipay){a='<li class="un-chosen" data-pay-tool="alipay">'+'<i class="icon-ok hide"></i>'+'<img class="unchosen-icon" src="https://static.baydn.com/static/img/icon-alipay-unchosen.png" alt="alipay">'+'<img class="chosen-icon" src="https://static.baydn.com/static/img/icon-alipay.png" alt="alipay">'+"<span>支付宝支付</span>"+"</li>"}var c='<div id="pay-view" class="modal-container rmb-pay-modal-container hide" style="display: block;">'+'<div class="modal">'+'<p class="pay-title">确认支付</p>'+'<span class="close-btn icon-close">×</span>'+'<div class="pay-content">'+'<p class="shell-amount">充值<span>'+pay.money+"</span></p>"+'<p class="money-amount">付款金额：<span>￥'+pay.money+"</span></p>"+'<p class="pay-method-title">选择支付方式：</p>'+'<ul class="pay-method-list">'+b+a+"</ul>"+'<a class="button confirm-charge-btn" data-pay-type="rmb">确认支付</a>'+'<a class="button cancel-btn close-btn">取消</a>'+"</div>"+"</div>"+"</div>";return c},qrCodeView:function(b){var a="http://qr.liantu.com/api.php?text="+b;var c='<div id="pay-view" class="modal-container wechat-pay-modal hide" style="display: block;">'+'<div class="modal">'+'<p class="pay-title">微信支付</p>'+'<span class="close-btn icon-close">×</span>'+'<div class="content">'+'<div class="left">'+"<p>打开微信扫一扫，扫描二维码支付</p>"+'<img class="wechat-pay-qrcode" data-img-src="data:image/png;base64," src="'+a+'">'+"<p>二维码有效时长为15分钟，</p>"+"<p>请尽快支付</p>"+"</div>"+'<div class="right">'+'<img src="https://static.baydn.com/static/img/wechat-pay-screen.png">'+"</div>"+"</div>"+"</div>"+"</div>";return c},successView:function(){var a='<div id="pay-view" class="modal-container wechat-pay-success-hint hide" style="display: block;">'+'<div class="modal">'+'<img src="https://static.baydn.com/static/img/wechat-pay-success.png">'+"<p>支付成功！2秒后自动关闭……</p>"+"</div>"+"</div>";return a},getCssUrl:function(){var c=document.getElementsByTagName("script");var b=/(wPay\.js)/g;var d="";for(var a in c){if(b.test(c[a]["src"])){d=c[a]["src"];break}}return d.replace(/wPay\.js/g,"css/wPay.css")}};